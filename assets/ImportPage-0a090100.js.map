{"version":3,"file":"ImportPage-0a090100.js","sources":["../../src/views/ImportPage.vue"],"sourcesContent":["<script setup lang=\"tsx\">\nimport { toValidURL } from '@/utils/check';\nimport { loadingBar, message } from '@/utils/discrete';\nimport { importFromNetwork } from '@/utils/import';\nimport { delay } from '@/utils/others';\nimport { githubZipStorage } from '@/utils/storage';\nimport { githubJpgStorage } from '@/utils/storage';\nimport { urlStorage, snapshotStorage } from '@/utils/storage';\nimport { githubImageUrlReg, githubZipUrlReg } from '@/utils/url';\nimport { onMounted, shallowRef } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\n\nconst route = useRoute();\nconst router = useRouter();\n\nconst importUrl = String(route.query.url || ``);\n\nconst loading = shallowRef(true);\nconst tip = shallowRef(`加载中...`);\n\nonMounted(async () => {\n  if (!toValidURL(importUrl)) {\n    message.error(`非法URL参数`);\n    await delay(1000);\n    router.replace({\n      path: `/`,\n    });\n    return;\n  }\n  await delay(1000);\n  const snapshotId = urlStorage[importUrl];\n  if (snapshotId) {\n    const snapshot = await snapshotStorage.getItem(snapshotId);\n    if (snapshot) {\n      router.replace({\n        name: 'snapshot',\n        params: { snapshotId },\n      });\n      return;\n    } else {\n      delete urlStorage[importUrl];\n    }\n  }\n  loadingBar.start();\n  try {\n    const [result] = (await importFromNetwork(importUrl)) ?? [];\n\n    if (result.status == 'fulfilled') {\n      loadingBar.finish();\n      const snapshot = result.value;\n      if (snapshot?.id) {\n        urlStorage[importUrl] = snapshot.id;\n        if (importUrl.match(githubZipUrlReg)) {\n          githubZipStorage[snapshot.id] = importUrl;\n        } else if (importUrl.match(githubImageUrlReg)) {\n          githubJpgStorage[snapshot.id] = importUrl;\n        }\n        loading.value = false;\n        await delay(500);\n        router.replace({\n          name: 'snapshot',\n          params: { snapshotId: snapshot.id },\n        });\n      } else {\n        tip.value = `获取资源失败`;\n      }\n    } else {\n      throw result.reason;\n    }\n  } catch {\n    loadingBar.error();\n    tip.value = `加载资源失败`;\n  }\n});\n</script>\n<template>\n  <div\n    class=\"h-[calc(100%-10px)]\"\n    flex\n    gap-5px\n    p-5px\n    flex-col\n    flex-items-center\n  >\n    <div v-show=\"loading\" mt-40px>\n      {{ tip }}\n    </div>\n  </div>\n</template>\n"],"names":["route","useRoute","router","useRouter","importUrl","String","query","url","loading","shallowRef","tip","onMounted","toValidURL","message","error","delay","replace","path","snapshotId","urlStorage","snapshotStorage","getItem","name","params","loadingBar","start","result","importFromNetwork","status","finish","snapshot","value","id","match","githubZipUrlReg","githubZipStorage","githubImageUrlReg","githubJpgStorage","reason"],"mappings":"idAYA,MAAMA,EAAQC,IACRC,EAASC,IAETC,EAAYC,OAAOL,EAAMM,MAAMC,KAAQ,EAAC,EAExCC,EAAUC,EAAW,EAAI,EACzBC,EAAMD,EAAY,QAAO,EAE/BE,OAAAA,EAAU,SAAY,CACpB,GAAI,CAACC,EAAWR,CAAS,EAAG,CAC1BS,EAAQC,MAAO,SAAQ,EACvB,MAAMC,EAAM,GAAI,EAChBb,EAAOc,QAAQ,CACbC,KAAO,GACT,CAAC,EACD,MACF,CACA,MAAMF,EAAM,GAAI,EAChB,MAAMG,EAAaC,EAAWf,CAAS,EACvC,GAAIc,EAEF,GADiB,MAAME,EAAgBC,QAAQH,CAAU,EAC3C,CACZhB,EAAOc,QAAQ,CACbM,KAAM,WACNC,OAAQ,CAAEL,WAAAA,CAAW,CACvB,CAAC,EACD,MACF,MACE,OAAOC,EAAWf,CAAS,EAG/BoB,EAAWC,MAAK,EAChB,GAAI,CACF,KAAM,CAACC,CAAM,EAAK,MAAMC,EAAkBvB,CAAS,GAAM,GAEzD,GAAIsB,EAAOE,QAAU,YAAa,CAChCJ,EAAWK,OAAM,EACjB,MAAMC,EAAWJ,EAAOK,MACpBD,GAAAA,MAAAA,EAAUE,IACZb,EAAWf,CAAS,EAAI0B,EAASE,GAC7B5B,EAAU6B,MAAMC,CAAe,EACjCC,EAAiBL,EAASE,EAAE,EAAI5B,EACvBA,EAAU6B,MAAMG,CAAiB,IAC1CC,EAAiBP,EAASE,EAAE,EAAI5B,GAElCI,EAAQuB,MAAQ,GAChB,MAAMhB,EAAM,GAAG,EACfb,EAAOc,QAAQ,CACbM,KAAM,WACNC,OAAQ,CAAEL,WAAYY,EAASE,EAAG,CACpC,CAAC,GAEDtB,EAAIqB,MAAS,QAEjB,KACE,OAAML,EAAOY,MAEjB,MAAQ,CACNd,EAAWV,MAAK,EAChBJ,EAAIqB,MAAS,QACf,CACF,CAAC"}